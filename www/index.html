<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Editor Markdown ao Vivo</title>
    <style>
        :root {
            --font: 16px "SF Mono", Consolas, monospace;
            --line-height: 1.5;
            --padding: 12px;
        }

        body {
            font-family: system-ui, sans-serif;
            background: #f5f5f5;
            display: flex;
            justify-content: center;
            padding: 1rem;
        }

        #container {
            position: relative;
            width: 100%;
            max-width: 700px;
        }

        #input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            resize: none;
            border: none;
            outline: none;
            background: transparent;
            color: transparent;
            caret-color: black;
            font: var(--font);
            line-height: var(--line-height);
            padding: var(--padding);
            white-space: pre-wrap;
            overflow: auto;
            z-index: 2;
        }

        label span {
            display: inline-block;
            margin-left: 2em;
        }

        #preview {
            border: 1px solid #ccc;
            border-radius: 10px;
            background: white;
            font: var(--font);
            line-height: var(--line-height);
            padding: var(--padding);
            min-height: 300px;
            white-space: pre-wrap;
            pointer-events: auto;
            color: #222;
            overflow: hidden;
        }

        input[type="checkbox"] {
            position: relative;
            transform: scale(1.2);
            margin-right: 6px;
            pointer-events: auto;
            cursor: pointer;
            overflow: auto;
            z-index: 31;
        }

        .done {
            text-decoration: line-through;
            color: #777;
            margin-left: 1.4em;
        }
    </style>
</head>

<body>
    <div id="container">
        <textarea id="input"></textarea>
        <div id="preview"></div>
    </div>

    <script>
        const input = document.getElementById("input");
        const preview = document.getElementById("preview");
        const STORAGE_KEY = "minhasNotasMarkdown";

        // --- Lista de 150 alimentos comuns em Portugal ---
        const alimentos = [
            "Arroz", "Feijão", "Batata", "Tomate", "Cebola", "Alho", "Azeite", "Pão", "Leite", "Ovos",
            "Carne de vaca", "Carne de porco", "Frango", "Peixe", "Atum", "Sardinha", "Bacalhau", "Cenoura",
            "Couve", "Espinafre", "Alface", "Brócolos", "Abóbora", "Pepino", "Pimento", "Salsa", "Coentros",
            "Maçã", "Pera", "Laranja", "Limão", "Banana", "Morango", "Uva", "Melão", "Melancia", "Kiwi",
            "Avelã", "Amêndoa", "Noz", "Castanha", "Amendoim", "Queijo", "Iogurte", "Manteiga", "Natas",
            "Cerveja", "Vinho", "Água", "Sumo de laranja", "Sumo de maçã", "Café", "Chá", "Chocolate", 
            "Açúcar", "Sal", "Pimenta", "Vinagre", "Mostarda", "Mel", "Arroz integral", "Massa", "Espaguete",
            "Macarrão", "Aveia", "Cuscuz", "Feijão preto", "Feijão vermelho", "Lentilhas", "Grão-de-bico",
            "Sopa de legumes", "Hambúrguer", "Salsicha", "Presunto", "Fiambre", "Mortadela", "Polvo", "Camarão",
            "Lula", "Ostras", "Amêijoas", "Mexilhões", "Bife", "Carne de cordeiro", "Perú", "Pato", "Gambas",
            "Batata-doce", "Rabanete", "Beterraba", "Couve-flor", "Espargos", "Cogumelos", "Aipo", "Alcaparras",
            "Azeitonas", "Abacate", "Frutos secos", "Gelatina", "Bolachas", "Bolo", "Pudim", "Creme", "Chouriço",
            "Salpicão", "Caril", "Molho de tomate", "Molho béchamel", "Mostarda Dijon", "Ketchup", "Maionese",
            "Iogurte natural", "Queijo fresco", "Queijo curado", "Ricota", "Mozarela", "Parmesão", "Cebola roxa",
            "Cebolinho", "Hortelã", "Manjericão", "Alecrim", "Tomilho", "Orégãos", "Funcho", "Gengibre", "Alcaparras",
            "Pimenta-do-reino", "Pimenta vermelha", "Páprica", "Canela", "Noz-moscada", "Cravinho", "Anis",
            "Coentros secos", "Sementes de abóbora", "Sementes de girassol", "Sementes de sésamo", "Levedo de cerveja",
            "Massa folhada", "Massa quebrada", "Farinha", "Fermento", "Bicarbonato de sódio", "Leite condensado",
            "Leite evaporado", "Cacau em pó", "Café solúvel", "Açúcar mascavado", "Açúcar em pó", "Sal marinho",
            "Vinagre balsâmico", "Vinagre de vinho", "Molho de soja", "Molho inglês", "Pimenta caiena"
        ];

        // --- Função para escolher alimento aleatório ---
        function getAlimentoAleatorio() {
            const index = Math.floor(Math.random() * alimentos.length);
            return alimentos[index];
        }

        // --- Inicializar textarea com alimento aleatório ---
        function initPlaceholder() {
            if (!localStorage.getItem(STORAGE_KEY)) {
                input.placeholder = getAlimentoAleatorio();
            }
        }

        // --- Carregar notas do localStorage ---
        function loadNotes() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) input.value = saved;
        }

        // --- Salvar notas no localStorage ---
        function saveNotes() {
            localStorage.setItem(STORAGE_KEY, input.value);
        }

        // --- Converte Markdown simples em HTML ---
        function renderMarkdown(text) {
            return text
                .replace(/^(\s*)- \[ \] (.*)$/gm, '$1<label><input type="checkbox"><span>$2</span></label>')
                .replace(/^(\s*)- \[x\] (.*)$/gm, '$1<label><input type="checkbox" checked> <span class="done">$2</span></label>');
        }

        // --- Atualiza visualização e salva ---
        function update() {
            preview.innerHTML = renderMarkdown(input.value);
            attachCheckboxEvents();
            syncScroll();
            saveNotes();
        }

        function syncScroll() {
            preview.scrollTop = input.scrollTop;
        }

        function attachCheckboxEvents() {
            preview.querySelectorAll("input[type='checkbox']").forEach((cb, i) => {
                cb.addEventListener("change", () => {
                    const lines = input.value.split("\n");
                    let count = 0;
                    for (let idx = 0; idx < lines.length; idx++) {
                        if (lines[idx].match(/^(\s*)- \[( |x)\]/i)) {
                            if (count === i) {
                                lines[idx] = cb.checked
                                    ? lines[idx].replace("- [ ]", "- [x]")
                                    : lines[idx].replace("- [x]", "- [ ]");
                                break;
                            }
                            count++;
                        }
                    }
                    input.value = lines.join("\n");
                    update();
                });
            });
        }

        // --- Nova linha com Enter ---
        input.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
                e.preventDefault();
                const pos = input.selectionStart;
                const before = input.value.substring(0, pos);
                const after = input.value.substring(pos);
                input.value = before + "\n- [ ] " + after;
                input.selectionStart = input.selectionEnd = pos + 7;
                update();
            }
        });

        input.addEventListener("input", update);
        input.addEventListener("scroll", syncScroll);

        // --- Inicialização ---
        initPlaceholder();
        loadNotes();
        update();
    </script>
</body>

</html>
